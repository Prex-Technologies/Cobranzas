{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "Cobranzas"
		},
		"ABS_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'ABS'"
		},
		"SqlDataBase_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'SqlDataBase'"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/subirDatosVacunacion')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "dfVacunacion",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "dfVacunacion",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"bddTxt": {},
									"bddSQL": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 32,
								"computeType": "MemoryOptimized"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/dfVacunacion')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/BDVacunacionTXT')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "ABS",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": "dosis.csv",
						"container": "vacunacion"
					},
					"columnDelimiter": ";",
					"escapeChar": "\\",
					"firstRowAsHeader": false,
					"quoteChar": "\""
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/ABS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/VacunacionSQL')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "SqlDataBase",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "Zona",
						"type": "nvarchar"
					},
					{
						"name": "Provincia",
						"type": "nvarchar"
					},
					{
						"name": "Ciudad",
						"type": "nvarchar"
					},
					{
						"name": "TipoIdentificacion",
						"type": "nvarchar"
					},
					{
						"name": "Identificacion",
						"type": "nvarchar"
					},
					{
						"name": "Nombre",
						"type": "nvarchar"
					},
					{
						"name": "Sexo",
						"type": "nvarchar"
					},
					{
						"name": "AnioNacimiento",
						"type": "nvarchar"
					},
					{
						"name": "MesNacimiento",
						"type": "nvarchar"
					},
					{
						"name": "DiaNacimiento",
						"type": "nchar"
					},
					{
						"name": "Nacionalidad",
						"type": "nvarchar"
					},
					{
						"name": "Email",
						"type": "nvarchar"
					},
					{
						"name": "Poblacion",
						"type": "nvarchar"
					},
					{
						"name": "Edad",
						"type": "int",
						"precision": 10
					},
					{
						"name": "FechaVacunacion",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "Vacunacion"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/SqlDataBase')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ABS')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('ABS_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SqlDataBase')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('SqlDataBase_connectionString')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/dfVacunacion')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "BDVacunacionTXT",
								"type": "DatasetReference"
							},
							"name": "bddTxt"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "VacunacionSQL",
								"type": "DatasetReference"
							},
							"name": "bddSQL"
						}
					],
					"transformations": [],
					"scriptLines": [
						"source(output(",
						"          Column_1 as string,",
						"          Column_2 as string,",
						"          Column_3 as string,",
						"          Column_4 as string,",
						"          Column_5 as string,",
						"          Column_6 as string,",
						"          Column_7 as string,",
						"          Column_8 as string,",
						"          Column_9 as string,",
						"          Column_10 as string,",
						"          Column_11 as string,",
						"          Column_12 as string,",
						"          Column_13 as string,",
						"          Column_14 as string,",
						"          Column_15 as string,",
						"          Column_16 as string,",
						"          Column_17 as integer,",
						"          Column_18 as date",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     partitionBy('dynamicRange', 1000,",
						"          Column_5",
						"     )) ~> bddTxt",
						"bddTxt sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          Zona as string,",
						"          Provincia as string,",
						"          Ciudad as string,",
						"          TipoIdentificacion as string,",
						"          Identificacion as string,",
						"          Nombre as string,",
						"          Sexo as string,",
						"          AnioNacimiento as string,",
						"          MesNacimiento as string,",
						"          DiaNacimiento as string,",
						"          Nacionalidad as string,",
						"          Email as string,",
						"          Poblacion as string,",
						"          Edad as integer,",
						"          FechaVacunacion as timestamp",
						"     ),",
						"     deletable:false,",
						"     insertable:true,",
						"     updateable:false,",
						"     upsertable:false,",
						"     format: 'table',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     errorHandlingOption: 'stopOnFirstError',",
						"     mapColumn(",
						"          Zona = Column_1,",
						"          Provincia = Column_3,",
						"          Ciudad = Column_4,",
						"          TipoIdentificacion = Column_5,",
						"          Identificacion = Column_6,",
						"          Nombre = Column_7,",
						"          Sexo = Column_8,",
						"          AnioNacimiento = Column_9,",
						"          MesNacimiento = Column_10,",
						"          DiaNacimiento = Column_11,",
						"          Nacionalidad = Column_12,",
						"          Email = Column_15,",
						"          Poblacion = Column_16,",
						"          Edad = Column_17,",
						"          FechaVacunacion = Column_18",
						"     )) ~> bddSQL"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/BDVacunacionTXT')]",
				"[concat(variables('factoryId'), '/datasets/VacunacionSQL')]"
			]
		}
	]
}